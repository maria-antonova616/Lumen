# Техническое Задание (Technical Specification)

## 1. Паспорт проекта
*   **Название:** LUMEN | Likedown Gallery System
*   **Тип:** SaaS-платформа для фотографов и их клиентов.
*   **Проблема:** Хаотичный сбор обратной связи через мессенджеры ("фото 123, 125, 140..."), отсутствие контроля за лимитами на ретушь.
*   **Решение:** Веб-сервис с удобным интерфейсом для отбора фотографий (Likedown), автоматическим контролем лимитов и аналитикой активности.

## 2. Ролевая модель
1.  **Фотограф (Owner):**
    *   Создает галереи и загружает массово фотографии.
    *   Настраивает права доступа (публичная/приватная) и лимиты (например, "Клиент может выбрать 15 фото").
    *   Генерирует уникальные ссылки-приглашения.
    *   Видит аналитику: кто заходил, какие фото популярны (тепловая карта интереса).
2.  **Клиент (User):**
    *   Заходит по приглашению или логину.
    *   Просматривает фото в удобном гриде.
    *   Ставит лайки (выбор фото) в рамках лимита.
    *   Оставляет комментарии к конкретным кадрам (пожелания по ретуши).
3.  **Администратор:** Техническое управление через Django Admin.

## 3. Архитектура данных (Модели)
Проект базируется на реляционной базе данных со следующими ключевыми сущностями:

1.  **CustomUser:** Расширенная модель пользователя. Поле `role` разделяет интерфейсы Фотографа и Клиента.
2.  **Gallery:** Основная сущность. Хранит настройки: `max_selection_count` (лимит на человека), `total_selection_limit` (общий лимит), `expires_at` (срок действия).
3.  **Photo:** Хранит изображение, превью (thumbnail) и порядковый номер для сортировки.
4.  **ClientChoice:** Таблица связей "Многие-ко-Многим" с дополнительными полями. Фиксирует факт лайка, просмотра и текст комментария пользователя к фото.
5.  **GalleryAccess:** Регулирует права доступа конкретных пользователей к галереям (роли: CLIENT/VIEWER).
6.  **GalleryInvite:** Хранит UUID-токены для генерации временных или многоразовых ссылок-приглашений.

## 4. Пользовательские сценарии (User Stories)
1.  **Upload:** Фотограф создает галерею "Wedding 2026", перетаскивает 100 файлов. Система создает объекты Photo.
2.  **Invite:** Фотограф создает ссылку-приглашение с ролью "Клиент" и лимитом использования (например, для 2 человек). Отправляет ссылку в мессенджер.
3.  **Selection:** Клиент переходит по ссылке. Система проверяет токен, авторизует (или регистрирует) и дает доступ. Клиент кликает "Лайк".
4.  **Validation:** При попытке лайкнуть 51-е фото при лимите 50, система выдает ошибку через AJAX-запрос и блокирует действие.
5.  **Analytics:** Фотограф открывает дашборд и видит график активности за последние дни (Chart.js) и список отобранных фото для экспорта.

## 5. Технический стек и Интеграции
*   **Backend:** Python 3.13, Django 5.0.
*   **Database:** SQLite (Dev) / PostgreSQL (Prod).
*   **Frontend:** Tailwind CSS (кастомный дизайн), JavaScript (Fetch API для асинхронных лайков).
*   **Analytics & Visualization:**
    *   **Django ORM Aggregation:** Сложные вычисления статистики (`Count`, `TruncDate`, `Q filters`) на стороне БД.
    *   **Chart.js:** Визуализация данных (динамика лайков/просмотров) на фронтенде.
*   **Utils:** SortableJS (Drag-and-drop сортировка фото), Pillow (обработка изображений).
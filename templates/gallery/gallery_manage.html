{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen bg-[#050505] text-white font-sans flex flex-col">
    <nav class="border-b border-white/10 bg-[#0a0a0a] px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-4">
          <a href="{% url 'dashboard' %}" class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-white transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i> Назад
          </a>
          <div class="h-6 w-[1px] bg-white/10"></div>
          <div>
              <h1 class="font-bold text-lg leading-none tracking-tight">Управление контентом</h1>
              <span class="text-[10px] text-gray-500 uppercase tracking-widest">{{ gallery.title }}</span>
          </div>
        </div>
        <a href="{% url 'gallery_delete' gallery.pk %}" class="text-[10px] md:text-xs text-red-500 hover:text-red-400 font-bold uppercase tracking-widest border border-red-900/50 px-3 py-1.5 hover:bg-red-900/20 transition-all">
            <i data-lucide="trash-2" class="w-3 h-3 inline mr-1"></i> Удалить галерею
        </a>
    </nav>
    <main class="p-6 md:p-8 max-w-[1920px] mx-auto w-full">
        {% if messages %}
        <div class="mb-6 space-y-2">
            {% for message in messages %}
            <div class="p-3 bg-green-900/20 border border-green-900 text-green-400 text-xs uppercase tracking-widest font-bold">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="bg-[#111] border border-white/10 p-8 rounded-sm mb-12">
            <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Добавить фотографии</h3>
            <form method="post" enctype="multipart/form-data" class="flex flex-col gap-4">
                {% csrf_token %}
                <label for="file-upload" class="flex flex-col items-center justify-center w-full h-40 border border-white/10 border-dashed rounded-sm cursor-pointer hover:bg-[#151515] hover:border-white/40 transition-all group relative">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6" id="upload-placeholder">
                        <i data-lucide="upload-cloud" class="w-10 h-10 text-gray-600 group-hover:text-white transition-colors mb-3"></i>
                        <p class="text-sm text-gray-400 uppercase tracking-widest"><span class="font-bold text-white">Кликните</span> чтобы выбрать файлы</p>
                        <p class="text-xs text-gray-600 mt-2">JPG, PNG (Можно выбрать много)</p>
                    </div>
                    <div id="file-info" class="hidden flex-col items-center justify-center pt-5 pb-6">
                         <i data-lucide="check-circle" class="w-10 h-10 text-green-500 mb-3"></i>
                         <p class="text-lg font-bold text-white" id="file-count">0 файлов</p>
                         <p class="text-xs text-gray-500 uppercase tracking-widest mt-2">Готовы к загрузке</p>
                    </div>
                    {{ form.images }}
                </label>
                <div class="flex justify-end">
                    <button type="submit" id="submit-btn" class="px-8 py-3 bg-white text-black text-xs font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors opacity-50 cursor-not-allowed" disabled>
                        Загрузить на сервер
                    </button>
                </div>
            </form>
        </div>
        <div class="flex items-center justify-between mb-6 pb-2 border-b border-white/10">
             <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest">Загруженные кадры ({{ photos.count }})</h3>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4">
            {% for photo in photos %}
            <div class="relative group bg-[#111] border border-[#222] hover:border-white/30 transition-all">
                <div class="aspect-[3/2] overflow-hidden bg-[#050505] relative">
                    <img src="{{ photo.image.url }}" loading="lazy" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity">
                    <div class="absolute inset-0 bg-black/80 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all backdrop-blur-sm">
                        <form action="{% url 'photo_delete' photo.pk %}" method="post" onsubmit="return confirm('Удалить этот кадр?');">
                            {% csrf_token %}
                            <button type="submit" class="w-10 h-10 rounded-full bg-red-600 text-white flex items-center justify-center hover:bg-red-500 transform hover:scale-110 transition-all">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <div class="p-2 border-t border-[#222] flex justify-between items-center bg-[#0f0f0f]">
                    <span class="text-[9px] font-mono text-gray-500">#{{ photo.sequence_number }}</span>
                    <div class="w-2 h-2 rounded-full {% if photo.status == 'UNVIEWED' %}bg-gray-700{% else %}bg-green-500{% endif %}"></div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full py-12 text-center text-gray-600 text-xs uppercase tracking-widest">
                Галерея пуста. Загрузите фотографии выше.
            </div>
            {% endfor %}
        </div>
    </main>
</div>
<script>
    const fileInput = document.getElementById('file-upload');
    const placeholder = document.getElementById('upload-placeholder');
    const fileInfo = document.getElementById('file-info');
    const fileCount = document.getElementById('file-count');
    const submitBtn = document.getElementById('submit-btn');
    fileInput.addEventListener('change', function(e) {
        if (this.files && this.files.length > 0) {
            placeholder.classList.add('hidden');
            fileInfo.classList.remove('hidden');
            fileInfo.classList.add('flex');
            fileCount.textContent = `Выбрано: ${this.files.length}`;
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            placeholder.classList.remove('hidden');
            fileInfo.classList.add('hidden');
            fileInfo.classList.remove('flex');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    });
</script>
{% endblock %}
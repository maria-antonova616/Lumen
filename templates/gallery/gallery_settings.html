{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen flex items-center justify-center p-4 bg-black">
    <div class="w-full max-w-2xl bg-[#111] border border-white/10 p-8 rounded shadow-2xl">
        <h2 class="text-2xl font-bold uppercase tracking-widest text-white mb-6 text-center">
            {% if is_create %}Создание Галереи{% else %}Настройки Галереи{% endif %}
        </h2>
        <form method="post">
            {% csrf_token %}
            <div class="space-y-4">
                {% for field in form %}
                    {% if field.field.widget.input_type == 'checkbox' %}
                        <div class="flex items-center gap-3 bg-[#1a1a1a]/30 p-3 rounded border border-white/5">
                            {{ field }}
                            <label for="{{ field.id_for_label }}" class="text-[10px] font-bold uppercase tracking-widest text-gray-400 cursor-pointer select-none">{{ field.label }}</label>
                        </div>
                    {% else %}
                        <div class="space-y-1">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500">{{ field.label }}</label>
                            {{ field }}
                        </div>
                    {% endif %}
                {% endfor %}

                {% if is_create %}
                   <hr class="border-white/10 my-6">
                   <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Первичный доступ</h3>
                   <div class="flex items-center gap-3 bg-[#1a1a1a]/30 p-3 rounded border border-white/5 mb-4">
                       {{ access_form.is_public }}
                       <label for="{{ access_form.is_public.id_for_label }}" class="text-[10px] font-bold uppercase tracking-widest text-gray-400 cursor-pointer select-none">Публичный доступ</label>
                   </div>
                   <div class="mt-4">
                       <label class="block text-xs font-bold uppercase tracking-widest text-gray-400 mb-2">Добавить пользователей</label>
                       {% include 'gallery/includes/user_tags_widget.html' with field=access_form.users_data %}
                   </div>
                {% endif %}
            </div>
            <div class="pt-6 flex flex-col gap-3">
                <button type="submit" class="w-full py-4 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors text-sm">
                    Сохранить
                </button>
                <a href="{% url 'dashboard' %}" class="w-full py-3 text-center border border-white/20 text-gray-400 hover:text-white uppercase tracking-widest text-xs hover:bg-white/5 transition-colors">Отмена</a>
            </div>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const commonLikes = document.getElementById('id_is_common_likes');
        const clientsSeeOthers = document.getElementById('id_clients_see_others');
        const viewersSeeLikes = document.getElementById('id_viewers_see_likes');
        if (commonLikes && clientsSeeOthers && viewersSeeLikes) {
            function updateState() {
                const isCommon = commonLikes.checked;
                const canSee = clientsSeeOthers.checked;

                if (isCommon) {
                    clientsSeeOthers.disabled = true;
                    clientsSeeOthers.parentElement.classList.add('opacity-50');
                } else {
                    clientsSeeOthers.disabled = false;
                    clientsSeeOthers.parentElement.classList.remove('opacity-50');
                }

                const hasPublicData = isCommon || canSee;
                if (hasPublicData) {
                    viewersSeeLikes.disabled = false;
                    viewersSeeLikes.parentElement.classList.remove('opacity-50', 'pointer-events-none');
                } else {
                    viewersSeeLikes.disabled = true;
                    viewersSeeLikes.checked = false; 
                    viewersSeeLikes.parentElement.classList.add('opacity-50', 'pointer-events-none');
                }
            }
            updateState();
            commonLikes.addEventListener('change', updateState);
            clientsSeeOthers.addEventListener('change', updateState);
        }
    });
</script>
{% endblock %}